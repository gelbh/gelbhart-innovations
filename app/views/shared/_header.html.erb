<header class="header navbar navbar-expand-lg navbar-sticky d-flex flex-column shadow-sm bg-light <%= 'position-absolute' if current_page?(root_path) %>">
  <div class="container position-relative d-flex align-items-center justify-content-between py-2 py-sm-3">
    <div class="d-flex align-items-center">
      <button type="button" class="navbar-toggler me-2 me-sm-3" data-bs-toggle="modal" data-bs-target="#mobileMenu" aria-controls="mobileMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Desktop navigation -->
      <div class="collapse navbar-collapse d-none d-lg-flex" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <div class="d-flex align-items-center position-relative">
              <%= link_to services_path, class: "nav-link pe-0 #{nav_active_class(services_path, pharmaceutical_path, real_estate_path)}", data: { turbo_preload: true }, style: "border-right: none;" do %>
                Services
              <% end %>
              <button class="btn dropdown-toggle dropdown-toggle-split ps-1 pe-2" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="border: none; background: none; color: inherit; font-size: 0.8rem; margin-left: -2px;">
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
            </div>
            <ul class="dropdown-menu">
              <li>
                <%= link_to services_path, class: "dropdown-item", data: { turbo_preload: true } do %>
                  <i class="bx bx-grid-alt text-primary me-2"></i>All Services
                <% end %>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <%= link_to pharmaceutical_path, class: "dropdown-item", data: { turbo_preload: true } do %>
                  <i class="bx bxs-capsule text-primary me-2"></i>Pharmaceutical
                <% end %>
              </li>
              <li>
                <%= link_to real_estate_path, class: "dropdown-item", data: { turbo_preload: true } do %>
                  <i class="bx bxs-buildings text-primary me-2"></i>Real Estate
                <% end %>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <%= link_to "Team", team_path, class: "nav-link #{nav_active_class(team_path)}", data: { turbo_preload: true } %>
          </li>
          <li class="nav-item">
            <%= link_to "Contact Us", contact_path, class: "nav-link #{nav_active_class(contact_path)}", data: { turbo_preload: true } %>
          </li>
        </ul>
      </div>
    </div>

    <%= link_to root_path, class: "position-absolute position-sm-absolute start-50 translate-middle-x align-items-center navbar-brand px-2 px-sm-3 #{current_page?(root_path) ? 'd-none' : 'd-flex'}", data: { turbo_preload: true } do %>
      <%= image_tag "logo.png", alt: "Gelbhart Inn. Logo", width: 50 %>
    <% end %>

    <div class="form-check form-switch mode-switch ms-auto" data-bs-toggle="mode">
      <label class="form-check-label d-none d-sm-inline" for="theme-mode">
        <i class="bx bx-bulb" role="theme" aria-label="Light Mode"><span class="d-none">Light Mode</span></i>
      </label>
      <input name="theme-mode" type="checkbox" class="form-check-input" id="theme-mode">
      <label class="form-check-label d-none d-sm-inline" for="theme-mode">
        <i class="bx bxs-bulb" role="theme" aria-label="Dark Mode"><span class="d-none">Dark Mode</span></i>
      </label>
    </div>
  </div>
</header>

<!-- Mobile Centered Popup Menu -->
<div class="modal fade" id="mobileMenu" tabindex="-1" aria-labelledby="mobileMenuLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content mobile-menu-popup">
      <div class="modal-header border-bottom">
        <h5 class="modal-title d-flex align-items-center" id="mobileMenuLabel">
          <%= image_tag "logo.png", alt: "Gelbhart Inn. Logo", width: 30, class: "me-2" %>
          <span>Menu</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <nav class="mobile-nav">
          <ul class="mobile-nav-list">
            <li class="mobile-nav-item">
              <a class="mobile-nav-link <%= 'active' if nav_active_class(services_path, pharmaceutical_path, real_estate_path).present? %>" href="#" role="button" data-bs-toggle="collapse" data-bs-target="#mobileServicesDropdown" aria-expanded="false" aria-controls="mobileServicesDropdown">
                <i class="bx bx-grid-alt me-2"></i>
                <span>Services</span>
                <i class="bx bx-chevron-down ms-auto mobile-nav-chevron"></i>
              </a>
              <div class="collapse" id="mobileServicesDropdown">
                <ul class="mobile-nav-sublist">
                  <li>
                    <%= link_to services_path, class: "mobile-nav-sublink d-flex align-items-center #{nav_active_class(services_path)}", data: { turbo_preload: true } do %>
                      <i class="bx bx-grid-alt me-2"></i>
                      All Services
                    <% end %>
                  </li>
                  <li>
                    <%= link_to pharmaceutical_path, class: "mobile-nav-sublink d-flex align-items-center #{nav_active_class(pharmaceutical_path)}", data: { turbo_preload: true } do %>
                      <i class="bx bxs-capsule me-2"></i>
                      Pharmaceutical
                    <% end %>
                  </li>
                  <li>
                    <%= link_to real_estate_path, class: "mobile-nav-sublink d-flex align-items-center #{nav_active_class(real_estate_path)}", data: { turbo_preload: true } do %>
                      <i class="bx bxs-buildings me-2"></i>
                      Real Estate
                    <% end %>
                  </li>
                </ul>
              </div>
            </li>
            <li class="mobile-nav-item">
              <%= link_to team_path, class: "mobile-nav-link d-flex align-items-center #{nav_active_class(team_path)}", data: { turbo_preload: true } do %>
                <i class="bx bx-group me-2"></i>
                <span>Team</span>
              <% end %>
            </li>
            <li class="mobile-nav-item">
              <%= link_to contact_path, class: "mobile-nav-link d-flex align-items-center #{nav_active_class(contact_path)}", data: { turbo_preload: true } do %>
                <i class="bx bx-envelope me-2"></i>
                <span>Contact Us</span>
              <% end %>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
