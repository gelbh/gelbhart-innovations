<%= render "shared/jarallax" %>
<%= render "shared/breadcrumb" %>

<section class="team-page container py-4 py-lg-5 px-3 px-sm-4 px-md-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">
      <span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill px-3 py-2 mb-3">
        <%= t('pages.team.badge') %>
      </span>
      <h2 class="display-6 fw-bold mb-3"><%= t('pages.team.title') %></h2>
      <p class="lead text-body-secondary mb-4 mb-lg-5">
        <%= t('pages.team.description') %>
      </p>
    </div>
  </div>

  <div class="team-grid row g-3 g-md-4 row-cols-1 row-cols-sm-2 row-cols-lg-3 justify-content-center">
    <% @members.each do |member| %>
      <% modal_id = "team-member-#{member.first_name.parameterize}" %>
      <% social_links = capture do %>
        <%= link_to member.linkedin_url,
                    target: "_blank",
                    rel: "noopener",
                    class: "team-card-social-link linkedin",
                    "aria-label": t('pages.team.linkedin_aria', name: member.name),
                    onclick: "event.stopPropagation();" do %>
          <i class="bx bxl-linkedin"></i>
        <% end %>
        <% if member.github? %>
          <%= link_to member.github_url,
                      target: "_blank",
                      rel: "noopener",
                      class: "team-card-social-link github",
                      "aria-label": t('pages.team.github_aria', name: member.name),
                      onclick: "event.stopPropagation();" do %>
            <i class="bx bxl-github"></i>
          <% end %>
        <% end %>
      <% end %>

      <article class="team-card col">
        <div class="team-card-inner card border-0 bg-transparent h-100 shadow-sm">
          <div class="team-card-media position-relative rounded-4 overflow-hidden"
               role="button"
               tabindex="0"
               data-bs-toggle="modal"
               data-bs-target="#<%= modal_id %>"
               aria-label="<%= t('pages.team.open_profile_aria', name: member.name) %>"
               onkeydown="if(event.key === 'Enter' || event.key === ' '){event.preventDefault(); this.click();}">
            <%= image_tag member.image_filename,
                          class: "team-card-image",
                          alt: member.name %>

            <div class="team-card-overlay">
              <div class="team-card-overlay-content">
                <div class="team-card-social team-card-social--overlay">
                  <%= social_links %>
                </div>
                <div class="team-card-cta text-white">
                  <span class="team-card-cta-text"><%= t('common.view_full_profile') %></span>
                  <i class="bx bx-chevron-right"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="team-card-body card-body text-center px-3 px-sm-4 py-3 py-md-4 d-flex flex-column">
            <h3 class="team-card-name h5 fw-semibold mb-2"><%= member.name %></h3>
            <p class="team-card-summary text-body-secondary fs-sm mb-3">
              <%= truncate(strip_tags(member.bio.to_s), length: 140) %>
            </p>
            <div class="team-card-actions mt-auto">
              <div class="team-card-social team-card-social--inline justify-content-center">
                <%= social_links %>
              </div>
              <button type="button"
                      class="btn btn-outline-primary w-100 mt-3 team-card-button"
                      data-bs-toggle="modal"
                      data-bs-target="#<%= modal_id %>">
                <%= t('common.learn_more') %>
              </button>
            </div>
          </div>
        </div>
      </article>
    <% end %>
  </div>

  <% @members.each do |member| %>
    <% modal_id = "team-member-#{member.first_name.parameterize}" %>
    <div class="modal fade team-modal"
         id="<%= modal_id %>"
         tabindex="-1"
         aria-labelledby="<%= "#{modal_id}-label" %>"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen-sm-down">
        <div class="modal-content">
          <div class="modal-header border-0 pb-0">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="<%= t('common.close') %>"></button>
          </div>
          <div class="modal-body pt-0">
            <div class="team-modal-header d-flex flex-column flex-md-row align-items-start gap-3 gap-md-4">
              <div class="team-modal-photo flex-shrink-0">
                <%= image_tag member.image_filename,
                              alt: member.name,
                              class: "w-100 h-100 object-fit-cover rounded-circle" %>
              </div>
              <div class="team-modal-summary text-start">
                <h5 class="team-modal-name h4 mb-3" id="<%= "#{modal_id}-label" %>"><%= member.name %></h5>
                <div class="team-modal-social d-flex flex-column flex-sm-row align-items-start gap-2">
                  <%= link_to member.linkedin_url,
                              target: "_blank",
                              rel: "noopener",
                              class: "team-modal-social-link linkedin" do %>
                    <i class="bx bxl-linkedin"></i>
                    <span><%= t('common.connect_on_linkedin') %></span>
                  <% end %>
                  <% if member.github? %>
                    <%= link_to member.github_url,
                                target: "_blank",
                                rel: "noopener",
                                class: "team-modal-social-link github" do %>
                      <i class="bx bxl-github"></i>
                      <span><%= t('common.view_github_profile') %></span>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="team-modal-bio mt-4">
              <%= team_member_bio(member) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</section>
